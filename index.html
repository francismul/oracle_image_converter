<!DOCTYPE html>
<html>
  <head>
    <title>Oracle Mode - Image Converter & Icon Generator</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- PWA Meta Tags -->
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#6a5acd" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <link
      rel="shortcut icon"
      href="assets/images/favicon.ico"
      type="image/x-icon"
    />
    <meta name="apple-mobile-web-app-title" content="Oracle Mode" />
    <link rel="apple-touch-icon" href="assets/images/icon-192.jpg" />

    <script src="assets/js/omggif.min.js"></script>
    <link rel="stylesheet" href="assets/css/oracle-image-processing.css" />
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üîÆ Oracle Mode</h1>
        <p>Professional Image Converter & Icon Generator</p>
      </div>

      <div class="main-content">
        <div class="tabs">
          <button class="tab active" onclick="switchTab('converter')">
            Image Converter
          </button>
          <button class="tab" onclick="switchTab('icon-generator')">
            Icon Generator
          </button>
          <button class="tab" onclick="switchTab('batch-processor')">
            Batch Processor
          </button>
        </div>

        <!-- Image Converter Tab -->
        <div id="converter" class="tab-content active">
          <div
            class="upload-zone"
            onclick="document.getElementById('imageInput').click()"
            ondrop="handleDrop(event)"
            ondragover="handleDragOver(event)"
            ondragleave="handleDragLeave(event)"
          >
            <div class="upload-icon">üìÅ</div>
            <h3>Drop your image here or click to upload</h3>
            <p>Supports: JPG, PNG, GIF, BMP, WEBP, SVG</p>
            <input
              type="file"
              id="imageInput"
              accept="image/*"
              onchange="handleImageUpload(event)"
            />
          </div>

          <div id="imageInfo" class="info-panel" style="display: none">
            <h3>Original Image Information</h3>
            <div id="imageDetails"></div>
            <img
              id="originalPreview"
              class="original-preview"
              style="display: none"
            />
          </div>

          <div id="formatOptions" class="format-grid" style="display: none">
            <div class="format-card">
              <h3>PNG</h3>
              <p>Lossless compression, supports transparency</p>
              <div class="size-options">
                <span
                  class="size-option"
                  onclick="selectSize(this, 'png', 'original')"
                  >Original</span
                >
                <span
                  class="size-option"
                  onclick="selectSize(this, 'png', '1920x1080')"
                  >1920√ó1080</span
                >
                <span
                  class="size-option"
                  onclick="selectSize(this, 'png', '1280x720')"
                  >1280√ó720</span
                >
                <span
                  class="size-option"
                  onclick="selectSize(this, 'png', '800x600')"
                  >800√ó600</span
                >
              </div>
              <button class="btn" onclick="convertImage('png')">
                Convert to PNG
              </button>
            </div>

            <div class="format-card">
              <h3>JPEG</h3>
              <p>Smaller file size, great for photos</p>
              <div class="size-options">
                <span
                  class="size-option"
                  onclick="selectSize(this, 'jpeg', 'original')"
                  >Original</span
                >
                <span
                  class="size-option"
                  onclick="selectSize(this, 'jpeg', '1920x1080')"
                  >1920√ó1080</span
                >
                <span
                  class="size-option"
                  onclick="selectSize(this, 'jpeg', '1280x720')"
                  >1280√ó720</span
                >
                <span
                  class="size-option"
                  onclick="selectSize(this, 'jpeg', '800x600')"
                  >800√ó600</span
                >
              </div>
              <label
                >Quality:
                <input
                  type="range"
                  id="jpegQuality"
                  min="10"
                  max="100"
                  value="85"
                  oninput="updateQualityDisplay(this.value)"
                />
                <span id="qualityDisplay">85%</span></label
              >
              <button class="btn" onclick="convertImage('jpeg')">
                Convert to JPEG
              </button>
            </div>

            <div class="format-card">
              <h3>WEBP</h3>
              <p>Modern format, excellent compression</p>
              <div class="size-options">
                <span
                  class="size-option"
                  onclick="selectSize(this, 'webp', 'original')"
                  >Original</span
                >
                <span
                  class="size-option"
                  onclick="selectSize(this, 'webp', '1920x1080')"
                  >1920√ó1080</span
                >
                <span
                  class="size-option"
                  onclick="selectSize(this, 'webp', '1280x720')"
                  >1280√ó720</span
                >
                <span
                  class="size-option"
                  onclick="selectSize(this, 'webp', '800x600')"
                  >800√ó600</span
                >
              </div>
              <button class="btn" onclick="convertImage('webp')">
                Convert to WEBP
              </button>
            </div>

            <div class="format-card">
              <h3>GIF</h3>
              <p>Animated images with full frame processing support</p>
              <div class="size-options">
                <span
                  class="size-option"
                  onclick="selectSize(this, 'gif', 'original')"
                  >Original</span
                >
                <span
                  class="size-option"
                  onclick="selectSize(this, 'gif', '800x600')"
                  >800√ó600</span
                >
                <span
                  class="size-option"
                  onclick="selectSize(this, 'gif', '400x300')"
                  >400√ó300</span
                >
              </div>
              <p style="font-size: 0.8em; color: #888; margin: 10px 0">
                ‚ú® Enhanced: Preserves animation, processes all frames
              </p>
              <button class="btn" onclick="convertImage('gif')">
                Convert to GIF
              </button>
            </div>
          </div>

          <div class="progress-bar" id="progressBar" style="display: none">
            <div class="progress-fill" id="progressFill"></div>
          </div>

          <div id="conversionResults" class="preview-grid"></div>
        </div>

        <!-- Icon Generator Tab -->
        <div id="icon-generator" class="tab-content">
          <div
            class="upload-zone"
            onclick="document.getElementById('iconInput').click()"
            ondrop="handleIconDrop(event)"
            ondragover="handleDragOver(event)"
            ondragleave="handleDragLeave(event)"
          >
            <div class="upload-icon">üé®</div>
            <h3>Upload image for icon generation</h3>
            <p>Or generate default Oracle Mode icons</p>
            <input
              type="file"
              id="iconInput"
              accept="image/*"
              onchange="handleIconUpload(event)"
            />
          </div>

          <div class="format-card">
            <h3>Generate PWA Icons</h3>
            <p>Creates all required icon sizes for Progressive Web Apps</p>
            <button class="btn" onclick="generateDefaultIcons()">
              Generate Default Icons
            </button>
            <button
              class="btn btn-secondary"
              onclick="generateCustomIcons()"
              id="customIconBtn"
              style="display: none"
            >
              Generate Custom Icons
            </button>
          </div>

          <div id="iconResults" class="preview-grid"></div>
        </div>

        <!-- Batch Processor Tab -->
        <div id="batch-processor" class="tab-content">
          <div
            class="upload-zone"
            onclick="document.getElementById('batchInput').click()"
            ondrop="handleBatchDrop(event)"
            ondragover="handleDragOver(event)"
            ondragleave="handleDragLeave(event)"
          >
            <div class="upload-icon">üì¶</div>
            <h3>Drop multiple images for batch processing</h3>
            <p>Convert multiple images at once</p>
            <input
              type="file"
              id="batchInput"
              accept="image/*"
              multiple
              onchange="handleBatchUpload(event)"
            />
          </div>

          <div id="batchControls" style="display: none">
            <div class="format-card">
              <h3>Batch Conversion Settings</h3>
              <div>
                <label
                  >Output Format:
                  <select id="batchFormat">
                    <option value="png">PNG</option>
                    <option value="jpeg">JPEG</option>
                    <option value="webp">WEBP</option>
                    <option value="gif">GIF</option>
                  </select>
                </label>
              </div>
              <div>
                <label
                  >Output Size:
                  <select id="batchSize">
                    <option value="original">Original</option>
                    <option value="1920x1080">1920√ó1080</option>
                    <option value="1280x720">1280√ó720</option>
                    <option value="800x600">800√ó600</option>
                  </select>
                </label>
              </div>
              <button class="btn" onclick="processBatch()">
                Process All Images
              </button>
              <button class="btn btn-secondary" onclick="downloadAllBatch()">
                Download All as ZIP
              </button>
            </div>
          </div>

          <div id="batchResults" class="preview-grid"></div>
        </div>
      </div>
    </div>

    <script src="assets/js/oracle-image-processing.js"></script>

    <!-- PWA Service Worker Registration -->
    <script>
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
          navigator.serviceWorker
            .register("sw.js")
            .then((registration) => {
              console.log("SW registered: ", registration);

              // Check for updates
              registration.addEventListener("updatefound", () => {
                const newWorker = registration.installing;
                newWorker.addEventListener("statechange", () => {
                  if (
                    newWorker.state === "installed" &&
                    navigator.serviceWorker.controller
                  ) {
                    // üîî Show toast instead of confirm
                    showUpdateToast();
                  }
                });
              });
            })
            .catch((registrationError) => {
              console.log("SW registration failed: ", registrationError);
            });
        });
      }

      // Toast notification for new version
      function showUpdateToast() {
        const toast = document.createElement("div");
        toast.innerHTML = `
      üöÄ A new version is available!
      <button id="refreshBtn" style="
        margin-left:10px;
        background:#fff;
        color:#333;
        border:none;
        padding:6px 12px;
        border-radius:4px;
        cursor:pointer;
      ">Refresh</button>
    `;
        toast.style.cssText = `
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #333;
      color: #fff;
      padding: 12px 18px;
      border-radius: 6px;
      font-family: sans-serif;
      font-size: 14px;
      z-index: 9999;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      animation: fadeIn 0.3s ease;
    `;

        document.body.appendChild(toast);

        // Button action
        document.getElementById("refreshBtn").onclick = () => {
          toast.remove();
          window.location.reload();
        };

        // Auto-hide after 15s
        setTimeout(() => {
          toast.style.opacity = "0";
          toast.style.transition = "opacity 0.5s";
          setTimeout(() => toast.remove(), 500);
        }, 15000);
      }

      // PWA Install prompt
      let deferredPrompt;
      window.addEventListener("beforeinstallprompt", (e) => {
        e.preventDefault();
        deferredPrompt = e;
        showInstallPromotion();
      });

      function showInstallPromotion() {
        if (!document.getElementById("installBtn")) {
          const installBtn = document.createElement("button");
          installBtn.id = "installBtn";
          installBtn.textContent = "üì± Install App";
          installBtn.className = "btn install-btn";
          installBtn.style.cssText = `
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 1000;
        background: linear-gradient(135deg, #6a5acd, #483d8b);
        color: white;
        border: none;
        padding: 12px 20px;
        border-radius: 25px;
        font-size: 14px;
        font-weight: bold;
        cursor: pointer;
        box-shadow: 0 4px 15px rgba(106, 90, 205, 0.3);
        transition: all 0.3s ease;
      `;

          installBtn.addEventListener("click", () => {
            if (deferredPrompt) {
              deferredPrompt.prompt();
              deferredPrompt.userChoice.then((choiceResult) => {
                if (choiceResult.outcome === "accepted") {
                  console.log("User accepted the install prompt");
                  installBtn.remove();
                } else {
                  console.log("User dismissed the install prompt");
                }
                deferredPrompt = null;
              });
            }
          });

          installBtn.addEventListener("mouseenter", () => {
            installBtn.style.transform = "translateY(-2px)";
            installBtn.style.boxShadow = "0 6px 20px rgba(106, 90, 205, 0.4)";
          });

          installBtn.addEventListener("mouseleave", () => {
            installBtn.style.transform = "translateY(0)";
            installBtn.style.boxShadow = "0 4px 15px rgba(106, 90, 205, 0.3)";
          });

          document.body.appendChild(installBtn);
        }
      }

      window.addEventListener("appinstalled", (evt) => {
        console.log("App was installed");
        const installBtn = document.getElementById("installBtn");
        if (installBtn) {
          installBtn.remove();
        }
      });
    </script>
  </body>
</html>
